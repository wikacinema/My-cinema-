<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wika Cinema & TV</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#e50914">
    <link rel="apple-touch-icon" href="https://i.ibb.co/zTr7jm5M/Picsart-26-01-16-01-39-26-682.png">
    <style>
        :root { --primary: #e50914; --bg: #0b0b0b; --card-bg: #1a1a1a; }
        body { background-color: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; overflow-x: hidden; }
        header { background: #000; padding: 10px 5%; display: flex; flex-direction: column; align-items: center; gap: 8px; border-bottom: 2px solid var(--primary); position: sticky; top: 0; z-index: 1000; }
        .logo { color: var(--primary); font-size: 24px; font-weight: bold; cursor: pointer; }
        .nav-tabs { display: flex; justify-content: center; gap: 8px; width: 100%; overflow-x: auto; scrollbar-width: none; }
        .tab-btn { background: #222; border: none; color: white; padding: 8px 15px; border-radius: 20px; cursor: pointer; transition: 0.3s; font-size: 13px; white-space: nowrap; }
        .tab-btn.active { background: var(--primary); font-weight: bold; }
        #search-input { padding: 10px 20px; border-radius: 20px; border: none; width: 100%; max-width: 400px; background: #222; color: white; outline: none; text-align: center; }
        .filter-section { background: #000; padding: 8px 0; border-bottom: 1px solid #333; }
        .filter-label { padding: 0 5%; font-size: 12px; color: #888; margin-bottom: 4px; display: block; }
        .filter-bar { display: flex; gap: 8px; overflow-x: auto; padding: 0 5% 10px 5%; scrollbar-width: none; }
        .filter-btn { background: #222; color: white; border: 1px solid #444; padding: 5px 12px; border-radius: 12px; cursor: pointer; white-space: nowrap; font-size: 11px; }
        .filter-btn.active { background: var(--primary); border-color: var(--primary); }
        .movie-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 12px; padding: 15px 5%; }
        .movie-card { background: var(--card-bg); border-radius: 8px; overflow: hidden; cursor: pointer; border: 1px solid #333; position: relative; }
        .movie-card img { width: 100%; height: 180px; display: block; background: #222; object-fit: contain; }
        .movie-info { padding: 6px; text-align: center; font-size: 11px; font-weight: bold; }
        .live-badge { position: absolute; top: 5px; right: 5px; background: red; color: white; font-size: 9px; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        #details-page, #player-page { display: none; position: fixed; inset: 0; background: #0b0b0b; z-index: 10000; overflow-y: auto; }
        .close-btn { position: fixed; top: 20px; left: 20px; background: rgba(255,0,0,0.8); color: white; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; z-index: 10001; }
        iframe, video { width: 100%; height: 100%; border: none; }
        .btn-action { background: var(--primary); color: white; border: none; padding: 12px 35px; border-radius: 25px; cursor: pointer; font-weight: bold; }
        @media (max-width: 500px) { .movie-grid { grid-template-columns: repeat(2, 1fr); } }
    </style>
</head>
<body>

<header>
    <div class="logo" onclick="location.reload()">WIKA CINEMA</div>
    <div class="nav-tabs">
        <button class="tab-btn active" id="tab-movies" onclick="switchMainTab('movies')">ğŸ¬ Ø£ÙÙ„Ø§Ù…</button>
        <button class="tab-btn" id="tab-tvshows" onclick="switchMainTab('tvshows')">ğŸï¸ Ù…Ø³Ù„Ø³Ù„Ø§Øª</button>
        <button class="tab-btn" id="tab-tv" onclick="switchMainTab('tv')">ğŸ“º ØªÙ„ÙØ²ÙŠÙˆÙ†</button>
    </div>
    <input type="text" id="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ÙÙŠÙ„Ù…ØŒ Ù…Ø³Ù„Ø³Ù„ØŒ Ù‚Ù†Ø§Ø©...">
</header>

<div id="section-content">
    <div class="filter-section">
        <span class="filter-label">Ø§Ù„Ø£ØµÙ†Ø§Ù:</span>
        <div class="filter-bar" id="genres-bar"></div>
        <span class="filter-label">Ø§Ù„Ù„ØºØ§Øª:</span>
        <div class="filter-bar" id="langs-bar"></div>
    </div>
    <div class="movie-grid" id="main-grid"></div>
    <button class="btn-action" style="display:block; margin:20px auto;" onclick="loadMore()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯</button>
</div>

<div id="section-tv" style="display:none;">
    <div class="filter-section">
        <div class="filter-bar" id="tv-filters">
            <button class="filter-btn active" onclick="renderTV('all', this)">ÙƒÙ„ Ø§Ù„Ù‚Ù†ÙˆØ§Øª</button>
            <button class="filter-btn" onclick="renderTV('Sport', this)">Ø±ÙŠØ§Ø¶Ø© âš½</button>
            <button class="filter-btn" onclick="renderTV('News', this)">Ø£Ø®Ø¨Ø§Ø± ğŸ“°</button>
            <button class="filter-btn" onclick="renderTV('Kids', this)">Ø£Ø·ÙØ§Ù„ ğŸ§¸</button>
            <button class="filter-btn" onclick="renderTV('Movies', this)">Ø£ÙÙ„Ø§Ù… ğŸ¬</button>
        </div>
    </div>
    <div class="movie-grid" id="tv-grid"></div>
</div>

<div id="details-page"><button class="close-btn" onclick="handleBack()">âœ•</button><div class="details-content" id="details-content" style="display:flex; flex-direction:column; align-items:center; padding:40px 20px; text-align:center; gap:15px;"></div></div>
<div id="player-page"><button class="close-btn" onclick="handleBack()">âœ•</button><div style="flex:1" id="video-frame"></div></div>

<script>
    const API_KEY = '243d3178406656f0f1ceb1fde181815e'; 
    const IMG = 'https://image.tmdb.org/t/p/w500';
    let page = 1, currentMode = 'movies', currentGenre = '', currentLang = '', searchQuery = '', tvChannels = [];

    const genresList = [{id: '', n: 'Ø§Ù„ÙƒÙ„'}, {id: '28', n: 'Ø£ÙƒØ´Ù†'}, {id: '35', n: 'ÙƒÙˆÙ…ÙŠØ¯ÙŠ'}, {id: '18', n: 'Ø¯Ø±Ø§Ù…Ø§'}, {id: '10751', n: 'Ø¹Ø§Ø¦Ù„ÙŠ'}, {id: '12', n: 'Ù…ØºØ§Ù…Ø±Ø©'}, {id: '80', n: 'Ø¬Ø±ÙŠÙ…Ø©'}, {id: '878', n: 'Ø®ÙŠØ§Ù„'}, {id: '10749', n: 'Ø±ÙˆÙ…Ø§Ù†Ø³'}, {id: '53', n: 'Ø¥Ø«Ø§Ø±Ø©'}, {id: '16', n: 'Ø£Ù†ÙŠÙ…ÙŠØ´Ù†'}, {id: '14', n: 'ØªØ§Ø±ÙŠØ®'}, {id: '99', n: 'ÙˆØ«Ø§Ø¦Ù‚ÙŠ'}, {id: '10402', n: 'Ù…ÙˆØ³ÙŠÙ‚Ù‰'}, {id: '37', n: 'ØºØ±Ø¨ÙŠ'}, {id: '36', n: 'Ø³ÙŠØ±Ø©'}];
    const langsList = [{id: '', n: 'Ø§Ù„ÙƒÙ„'}, {id: 'ar', n: 'Ø¹Ø±Ø¨ÙŠ'}, {id: 'en', n: 'Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ'}, {id: 'fr', n: 'ÙØ±Ù†Ø³ÙŠ'}, {id: 'tr', n: 'ØªØ±ÙƒÙŠ'}, {id: 'ko', n: 'ÙƒÙˆØ±ÙŠ'}, {id: 'hi', n: 'Ù‡Ù†Ø¯ÙŠ'}, {id: 'ja', n: 'ÙŠØ§Ø¨Ø§Ù†ÙŠ'}, {id: 'es', n: 'Ø¥Ø³Ø¨Ø§Ù†ÙŠ'}, {id: 'it', n: 'Ø¥ÙŠØ·Ø§Ù„ÙŠ'}, {id: 'de', n: 'Ø£Ù„Ù…Ø§Ù†ÙŠ'}, {id: 'ru', n: 'Ø±ÙˆØ³ÙŠ'}];

    window.onpopstate = () => hidePages();
    function handleBack() { history.back(); }

    function switchMainTab(type) {
        currentMode = type; page = 1; searchQuery = '';
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.id === 'tab-'+type));
        document.getElementById('section-content').style.display = type === 'tv' ? 'none' : 'block';
        document.getElementById('section-tv').style.display = type === 'tv' ? 'block' : 'none';
        if(type === 'tv' && tvChannels.length === 0) fetchTV(); else if(type !== 'tv') { renderFilters(); fetchContent(); }
    }

    // Ø¬Ù„Ø¨ Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ø§Ù„Ø°ÙŠ Ø£Ø±Ø³Ù„ØªÙ‡
    async function fetchTV() {
        const grid = document.getElementById('tv-grid');
        grid.innerHTML = '<p>Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©...</p>';
        try {
            const res = await fetch('https://iptv-org.github.io/iptv/index.m3u');
            const data = await res.text();
            const lines = data.split('\n');
            tvChannels = [];
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].startsWith('#EXTINF')) {
                    const info = lines[i];
                    const url = lines[i + 1]?.trim();
                    const name = info.split(',')[1]?.trim() || "Channel";
                    const logo = info.match(/tvg-logo="([^"]+)"/)?.[1] || "https://via.placeholder.com/300x450/111/fff?text=TV";
                    const group = info.match(/group-title="([^"]+)"/)?.[1] || "";
                    if(url && url.startsWith('http')) tvChannels.push({name, url, logo, group});
                }
            }
            renderTV('all');
        } catch (e) { grid.innerHTML = 'Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù‚Ù†ÙˆØ§Øª.'; }
    }

    function renderTV(filter, btn) {
        if(btn) {
            document.querySelectorAll('#tv-filters .filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }
        const grid = document.getElementById('tv-grid');
        grid.innerHTML = '';
        const filtered = tvChannels.filter(c => filter === 'all' || c.group.toLowerCase().includes(filter.toLowerCase())).slice(0, 100);
        filtered.forEach(c => {
            const div = document.createElement('div');
            div.className = 'movie-card';
            div.onclick = () => openIPTV(c.url);
            div.innerHTML = `<span class="live-badge">LIVE</span><img src="${c.logo}"><div class="movie-info">${c.name}</div>`;
            grid.appendChild(div);
        });
    }

    function renderFilters() {
        document.getElementById('genres-bar').innerHTML = genresList.map(g => `<button class="filter-btn ${currentGenre==g.id?'active':''}" onclick="updateFilter('genre','${g.id}',this)">${g.n}</button>`).join('');
        document.getElementById('langs-bar').innerHTML = langsList.map(l => `<button class="filter-btn ${currentLang==l.id?'active':''}" onclick="updateFilter('lang','${l.id}',this)">${l.n}</button>`).join('');
    }

    async function fetchContent(isMore = false) {
        const grid = document.getElementById('main-grid');
        if(!isMore) { page = 1; grid.innerHTML = '<p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>'; }
        const type = currentMode === 'movies' ? 'movie' : 'tv';
        let url = `https://api.themoviedb.org/3/discover/${type}?api_key=${API_KEY}&language=ar-SA&sort_by=popularity.desc&page=${page}`;
        if(currentGenre) url += `&with_genres=${currentGenre}`;
        if(currentLang) url += `&with_original_language=${currentLang}`;
        if(searchQuery) url = `https://api.themoviedb.org/3/search/${type}?api_key=${API_KEY}&language=ar-SA&query=${encodeURIComponent(searchQuery)}&page=${page}`;
        const res = await fetch(url);
        const data = await res.json();
        if(!isMore) grid.innerHTML = '';
        data.results.forEach(i => {
            if(!i.poster_path) return;
            const div = document.createElement('div');
            div.className = 'movie-card';
            div.onclick = () => showDetails(i);
            div.innerHTML = `<img src="${IMG + i.poster_path}"><div class="movie-info">${i.title || i.name}</div>`;
            grid.appendChild(div);
        });
    }

    function showDetails(i) {
        document.getElementById('details-page').style.display = 'block';
        history.pushState({p: 'd'}, "", "#details");
        const type = currentMode === 'movies' ? 'movie' : 'tv';
        document.getElementById('details-content').innerHTML = `<img src="${IMG + i.poster_path}" style="width:180px; border-radius:12px;"><h1>${i.title || i.name}</h1><p>${i.overview || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ.'}</p><button class="btn-action" onclick="openPlayer('${i.id}','${type}')">â–¶ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¢Ù†</button>`;
    }

    function openPlayer(id, type) {
        document.getElementById('player-page').style.display = 'flex';
        const embedUrl = type === 'movie' ? `https://vidsrc.me/embed/movie?tmdb=${id}` : `https://vidsrc.me/embed/tv?tmdb=${id}`;
        document.getElementById('video-frame').innerHTML = `<iframe src="${embedUrl}" allowfullscreen></iframe>`;
        history.pushState({p: 'p'}, "", "#player");
    }

    function openIPTV(url) {
        document.getElementById('player-page').style.display = 'flex';
        document.getElementById('video-frame').innerHTML = `<video controls autoplay style="width:100%; height:100%"><source src="${url}" type="application/x-mpegURL"></video>`;
        history.pushState({p: 'p'}, "", "#player");
    }

    function hidePages() { document.getElementById('details-page').style.display = 'none'; document.getElementById('player-page').style.display = 'none'; document.getElementById('video-frame').innerHTML = ''; }
    function updateFilter(t, v) { if(t === 'genre') currentGenre = v; else currentLang = v; renderFilters(); fetchContent(); }
    function loadMore() { page++; fetchContent(true); }
    document.getElementById('search-input').oninput = (e) => { searchQuery = e.target.value; fetchContent(); };

    renderFilters();
    fetchContent();
</script>
</body>
</html>